<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Despertador de Ponto</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      padding: 2rem;
    }

    .container {
      background: rgba(255, 255, 255, 0.1);
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 0 2rem rgba(0, 0, 0, 0.3);
      text-align: center;
    }

    input[type="time"] {
      padding: 0.8rem;
      font-size: 1.2rem;
      border: none;
      border-radius: 0.5rem;
      margin: 1rem 0;
      background: rgba(255, 255, 255, 0.9);
    }

    button {
      padding: 1rem 2rem;
      font-size: 1.1rem;
      background: #00cc66;
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: transform 0.2s;
    }

    button:hover {
      transform: scale(1.05);
      background: #00b359;
    }

    .status {
      margin-top: 2rem;
      padding: 1rem;
      border-radius: 0.5rem;
      background: rgba(255, 255, 255, 0.1);
    }

    .alarm-active {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .ntfy-link {
      display: block;
      margin-top: 1.5rem;
      color: #00cc66;
      text-decoration: none;
      font-weight: bold;
      transition: opacity 0.3s;
    }

    .ntfy-link:hover {
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚è∞ Despertador de Ponto</h1>
    <input type="time" id="alarmTime">
    <button onclick="setAlarm()">Definir Alarme</button>
    <button onclick="stopAlarm()" style="background: #ff4444; margin-left: 1rem;">Parar Alarme</button>
    <div class="status" id="status">Alarme n√£o configurado</div>
    <a href="view.html" class="ntfy-link" target="_blank">üîî Abrir Portal de Notifica√ß√µes</a>
  </div>

  <script>
    let alarmInterval = null;
    let audioContext = null;
    let oscillator = null;

    function playAlarmSound() {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.type = 'square';
      oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
      gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
      
      oscillator.start();
    }

    function stopAlarmSound() {
      if (oscillator) {
        oscillator.stop();
        oscillator.disconnect();
        oscillator = null;
      }
    }

    async function sendNtfyNotification() {
      try {
        const response = await fetch('https://ntfy.sh/alarme-de-ponto', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
          '‚è∞ Hora de bater o ponto!',
          })
        });
        
        if (!response.ok) throw new Error('Falha na notifica√ß√£o');
      } catch (error) {
        console.error('Erro:', error);
      }
    }

    function setAlarm() {
      const alarmTime = document.getElementById('alarmTime').value;
      if (!alarmTime) return;

      const [hours, minutes] = alarmTime.split(':');
      const now = new Date();
      const alarmDate = new Date(
        now.getFullYear(),
        now.getMonth(),
        now.getDate(),
        hours,
        minutes
      );

      if (alarmDate <= now) {
        alert('Selecione um hor√°rio futuro!');
        return;
      }

      if (alarmInterval) clearInterval(alarmInterval);
      
      alarmInterval = setInterval(() => {
        const currentTime = new Date();
        if (currentTime >= alarmDate) {
          triggerAlarm();
          clearInterval(alarmInterval);
        }
      }, 1000);

      document.getElementById('status').textContent = `Alarme configurado para ${alarmTime}`;
    }

    async function triggerAlarm() {
      document.getElementById('status').classList.add('alarm-active');
      document.getElementById('status').textContent = '‚è∞ Hora de bater o ponto!';
      
      playAlarmSound();
      await sendNtfyNotification();
      alert('‚è∞ Hora de bater o ponto!');
    }

    function stopAlarm() {
      clearInterval(alarmInterval);
      stopAlarmSound();
      document.getElementById('status').classList.remove('alarm-active');
      document.getElementById('status').textContent = 'Alarme desativado';
    }
  </script>
</body>
</html>
